<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Chad Sikorra">
        <link rel="canonical" href="http://www.phpldaptools.com/tutorials/Building-LDAP-Queries/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Building LDAP Queries - LdapTools</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">LdapTools</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cookbook <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../cookbook/Authenticating-a-User/">Authenticating a User</a>
</li>

                        
                            
<li >
    <a href="../../cookbook/Common-LDAP-Queries/">Common LDAP Queries</a>
</li>

                        
                            
<li >
    <a href="../../cookbook/Creating-a-Custom-Repository/">Creating a Custom Repository</a>
</li>

                        
                            
<li >
    <a href="../../cookbook/Modifying-GPO-Links-on-OUs/">Modifying GPO Links on OUs</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../AD-User-Modification/">AD User Modification</a>
</li>

                        
                            
<li class="active">
    <a href="./">Building LDAP Queries</a>
</li>

                        
                            
<li >
    <a href="../Creating-AD-Password-Settings-Objects/">Creating AD Password Settings Objects</a>
</li>

                        
                            
<li >
    <a href="../Creating-LDAP-Objects/">Creating LDAP Objects</a>
</li>

                        
                            
<li >
    <a href="../LDIF-Files/">LDIF Files</a>
</li>

                        
                            
<li >
    <a href="../Modifying-LDAP-Objects/">Modifying LDAP Objects</a>
</li>

                        
                            
<li >
    <a href="../Using-the-LDAP-Manager/">Using the LDAP Manager</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../reference/Attribute-Converters/">Attribute Converters</a>
</li>

                        
                            
<li >
    <a href="../../reference/Default-Schema-Attributes/">Default Schema Attributes</a>
</li>

                        
                            
<li >
    <a href="../../reference/Events/">Events</a>
</li>

                        
                            
<li >
    <a href="../../reference/Logging/">Logging</a>
</li>

                        
                            
<li >
    <a href="../../reference/Main-Configuration/">Main Configuration</a>
</li>

                        
                            
<li >
    <a href="../../reference/Schema-Configuration/">Schema Configuration</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../AD-User-Modification/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Creating-AD-Password-Settings-Objects/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/ldaptools/ldaptools/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#building-ldap-queries">Building LDAP Queries</a></li>
        
            <li><a href="#generating-ldap-filters-without-ldapmanager">Generating LDAP Filters Without LdapManager</a></li>
        
            <li><a href="#generating-queries-when-using-the-ldapmanager">Generating Queries When Using the LdapManager</a></li>
        
            <li><a href="#ldapquerybuilder-methods">LdapQueryBuilder Methods</a></li>
        
            <li><a href="#using-aliases">Using Aliases</a></li>
        
            <li><a href="#ldapquery-methods-to-retrieve-ldap-results">LdapQuery Methods to Retrieve LDAP Results</a></li>
        
            <li><a href="#filter-method-shortcuts">Filter Method Shortcuts</a></li>
        
            <li><a href="#active-directory-filter-method-shortcuts">Active Directory Filter Method Shortcuts</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="building-ldap-queries">Building LDAP Queries</h1>
<hr />
<p>The <code>LdapQueryBuilder</code> class provides an easy object oriented method of producing LDAP filters of any complexity. Those
familiar with Doctrine's QueryBuilder will find this syntax easy to adapt to, as it is pretty much the same. This class
takes care of escaping all values passed to it when generating the filter.</p>
<ul>
<li><a href="#ldapquerybuilder-methods">LdapQueryBuilder Methods</a></li>
<li><a href="#filter-method-shortcuts">Filter Method Shortcuts</a></li>
<li><a href="#using-aliases-in-queries">Using Aliases</a></li>
<li><a href="#ldapquery-methods-to-retrieve-ldap-results">Retrieving Query Results</a></li>
</ul>
<h2 id="generating-ldap-filters-without-ldapmanager">Generating LDAP Filters Without LdapManager</h2>
<hr />
<p>This class is most easily used in the context of the <code>LdapManager</code>, but it is also possible to use on its own if your 
only desire is to generate LDAP filters.</p>
<pre><code class="php">use LdapTools\Query\LdapQueryBuilder;

$lqb = new LdapQueryBuilder();

$filter = $lqb-&gt;select('givenName', 'sn', 'l')
    -&gt;where(['objectClass' =&gt; 'user'])
    -&gt;andWhere($lqb-&gt;filter()-&gt;like('sAMAccountName','*smith'))
    -&gt;toLdapFilter();

echo &quot;LDAP Filter: &quot;.$filter.PHP_EOL;
</code></pre>

<h2 id="generating-queries-when-using-the-ldapmanager">Generating Queries When Using the LdapManager</h2>
<hr />
<p>When you call <code>buildLdapQuery</code> in the <code>LdapManager</code> you will get an instance of the <code>LdapQueryBuilder</code> class that knows
all the information about the schema of your domain, and a <code>LdapConnection</code> capable of executing the query. With this
information it can do a lot of the heavy lifting to allow it to easily generate any LDAP filter.</p>
<pre><code class="php">$lqb = $ldapManager-&gt;buildLdapQuery();

// When no attributes are specifically selected, it will pull a default set defined in the schema.
$users = $lqb-&gt;fromUsers()
    -&gt;where(['state' =&gt; 'Wisconsin'])
    -&gt;getLdapQuery()
    -&gt;getResult();

foreach ($users as $user) {
    foreach ($user-&gt;toArray() as $attribute =&gt; $value) {
        echo $attribute.' =&gt; '.$value.PHP_EOL;
    }
}
</code></pre>

<h2 id="ldapquerybuilder-methods">LdapQueryBuilder Methods</h2>
<p>This class provides many methods that simplify the process of creating complex LDAP filters. The following is a list of
the methods and their general use.</p>
<hr />
<h4 id="selectattributes">select($attributes)</h4>
<p>The <code>select</code> method allows you to choose specifically which attributes you would like to return from the query. Simply
pass an array of attribute names to it that you would like, or a single attribute as a string. In the absence of 
anything passed to it, it will select the default set of attributes for the query as defined for the type in the schema.</p>
<p>To retrieve all attributes defined in the schema you can pass a single wildcard <code>*</code> as a selected attribute. In the
absence of a schema doing that will also select all LDAP attributes. To select all LDAP attributes and all schema
attributes for a LDAP object you can pass a double wildcard <code>**</code> as a selected attribute.</p>
<p>Attribute names are looked for in the schema to see if they map to specific LDAP attributes.</p>
<pre><code class="php">$lqb-&gt;select(['firstName', 'city', 'state', 'sid']);

// Select only a single attribute
$lqb-&gt;select('guid');

// Attribute names will always be returned in the case you enter it in, irrespective of how LDAP returns the data.
$lqb-&gt;select(['FirstName', 'City', 'State', 'SID']);

// Select all attributes defined in the schema for a LDAP object
$lqb-&gt;select('*');

// Select all attributes both in the schema and from LDAP for an object
$lqb-&gt;select('**');
</code></pre>

<p>If you want the raw data to be returned from LDAP you can select LDAP attribute names explicitly. You can also include 
schema names at the same time. Attributes selected by their LDAP attribute name will <strong>NOT</strong> have attribute 
conversion done.</p>
<pre><code class="php">// Will return 'objectSid' AND 'sid'
$lqb-&gt;select(['givenName', 'l', 'objectSid', 'sid']);
</code></pre>

<hr />
<h4 id="fromldaptype-alias-null">from($ldapType, $alias = null)</h4>
<p>The <code>from</code> method requires an argument for the LDAP type. This type must be defined in your LDAP schema. Common types
that are in the schema by default include: <code>user</code>, <code>group</code>, <code>contact</code>, <code>computer</code>, <code>ou</code>. These types are defined as constants
in the <code>\LdapTools\Object\LdapObjectType</code> class. Using this method makes the query aware of the attribute name mapping
and converters defined for the type.</p>
<pre><code class="php">use LdapTools\Object\LdapObjectType;

// Search for users
$lqb-&gt;from(LdapObjectType::USER);

// Search for computers
$lqb-&gt;from(LdapObjectType::COMPUTER);

// Search for users and assign an alias to it
$lqb-&gt;from(LdapObjectType::USER, 'u');
</code></pre>

<p>You can also call the <code>from()</code> method dynamically for schema types you have defined:</p>
<pre><code class="php">// Selects from the 'ExchangeServer' schema type.
$lqb-&gt;fromExchangeServer();

// Selects from the 'container' schema type, and assigns it an alias of 'c'.
$lqb-&gt;fromContainer('c');
</code></pre>

<hr />
<h4 id="fromusersalias-null">fromUsers($alias = null)</h4>
<p>A convenience shortcut of the <code>from</code> method to select from LDAP <code>user</code> types. Optionally pass a string alias name.</p>
<pre><code class="php">// Search for users
$lqb-&gt;fromUsers();
</code></pre>

<hr />
<h4 id="fromgroupsalias-null">fromGroups($alias = null)</h4>
<p>A convenience shortcut of the <code>from</code> method to select from LDAP <code>group</code> types. Optionally pass a string alias name.</p>
<pre><code class="php">// Search for groups
$lqb-&gt;fromGroups();
</code></pre>

<hr />
<h4 id="fromousalias-null">fromOUs($alias = null)</h4>
<p>A convenience shortcut of the <code>from</code> method to select from LDAP <code>ou</code> types. Optionally pass a string alias name.</p>
<pre><code class="php">// Search for OUs
$lqb-&gt;fromOUs();
</code></pre>

<hr />
<h4 id="wherestatements">where(...$statements)</h4>
<p>This method encapsulates its arguments into a logical 'AND' statement. You can either pass a simple array of attributes
and values that must be met, or any number of filter operator statements.</p>
<pre><code class="php">// Pass a simple array of attributes =&gt; values. These attributes must be equal to these values.
$lqb-&gt;where(['firstName' =&gt; 'Timmy', 'state' =&gt; 'Wyoming']);

// Pass filter operator statements instead. It will take care of attribute value conversions as well.
$lqb-&gt;where($lqb-&gt;filter()-&gt;gte('created', new \DateTime('5-4-2000'));

// A more complex series of statements
$lqb-&gt;where(
    $lqb-&gt;filter()-&gt;neq('firstName', 'Jimbo'),
    $lqb-&gt;filter()-&gt;bOr(
        $lqb-&gt;filter()-&gt;eq('lastName', 'Dodgson'), 
        $lqb-&gt;filter()-&gt;eq('lastName', 'Venkman')
    )
);
</code></pre>

<hr />
<h4 id="andwherestatements">andWhere(...$statements)</h4>
<p>This method is the same as the <code>where</code> method. It encapsulates its arguments into a logical 'AND' statement. Statements
passed will be added to the same logical 'AND' statement that the <code>where</code> method created.</p>
<pre><code class="php">// This adds to the existing and statement...
$lqb-&gt;andWhere(['lastName' =&gt; 'Smith']);
</code></pre>

<hr />
<h4 id="orwherestatements">orWhere(...$statements)</h4>
<p>This method is the same as the <code>where</code> method, but it will instead encapsulate any passed arguments into a logical 'OR'
statement.</p>
<pre><code class="php">// This creates a separate OR statement...
$lqb-&gt;orWhere(['department' =&gt; 'IT', 'department' =&gt; 'Marketing']);
</code></pre>

<hr />
<h4 id="addstatements">add(...$statements)</h4>
<p>This is a low-level method that will take any object that is an instance of a <code>BaseOperator</code> and add it to the query.
The shorthand <code>$lqb-&gt;filter()</code> methods is what does the heavy-lifting for creating the various operator objects. You
should not need to call this method explicitly, but it is included if you need it.</p>
<pre><code class="php">// Add some operators directly to the query
$lqb-&gt;add($lqb-&gt;filter()-&gt;startsWith('name', 'srv'), $lqb-&gt;filter()-&gt;notPresent('description'));
</code></pre>

<hr />
<h4 id="setserverserver">setServer($server)</h4>
<p>This lets you set the LDAP server that the query will run against when executed. After the query finishes executing the
connection switches back to the LDAP server it was originally connected to.</p>
<pre><code class="php">// Query a specific LDAP server
$lqb-&gt;setServer('dc3.example.local');
</code></pre>

<hr />
<h4 id="setbasednbasedn">setBaseDn($baseDn)</h4>
<p>This method sets the base DN (distinguished name) for the query. That means that any LDAP object at or below this point
in the directory will be queried for. This will default first to a <code>base_dn</code> set in the schema for the object type you
 are searching for and if that is not set it will default to whatever you set in the domain configuration for the
<code>base_dn</code> value.</p>
<pre><code class="php">$lqb-&gt;setBaseDn('OU=Employees,OU=Users,DC=example,DC=com')
</code></pre>

<hr />
<h4 id="setscopesubtree">setScopeSubTree()</h4>
<p>'subtree' is the default search scope for the query and should not need to be called explicitly. This method sets the 
LDAP search scope recursively from the point of the base DN onwards.</p>
<hr />
<h4 id="setscopeonelevel">setScopeOneLevel()</h4>
<p>This method sets the LDAP search scope to one level at the point of the base DN. This is equivalent to a non-recursive
 listing of the contents of a folder directory. The search will not recurse any further than the level of the base DN.</p>
<hr />
<h4 id="setscopebase">setScopeBase()</h4>
<p>This method sets the LDAP search scope to the base level. This is used to retrieve the contents of a single entry, and 
is most commonly used to retrieve the RootDSE of a domain.</p>
<p>Example usage to return the RootDSE for a domain:</p>
<pre><code class="php">// NOTE: You can also call the getRootDse() method on the connection object to get the RootDSE...
$rootDse = $lqb-&gt;where($lqb-&gt;filter()-&gt;present('objectClass'))
                -&gt;setBaseDn('')
                -&gt;setScopeBase()
                -&gt;getLdapQuery()
                -&gt;getSingleResult();
</code></pre>

<hr />
<h4 id="setscopescope">setScope($scope)</h4>
<p>Explicitly set the scope for the query using the <code>QueryOperation::SCOPE</code> constant. The available options are:
<code>QueryOperation::SCOPE['SUBTREE']</code>, <code>QueryOperation::SCOPE['ONELEVEL']</code>, <code>QueryOperation::SCOPE['BASE']</code></p>
<pre><code class="php">use LdapTools\Operation\QueryOperation;

$lqb-&gt;setScope(QueryOperation::SCOPE['ONELEVEL']);
</code></pre>

<hr />
<h4 id="orderbyattribute-direction-asc">orderBy($attribute, $direction = 'ASC')</h4>
<p>This method sets the attribute to order the results by in either ascending (default) or descending order. Calling this 
overwrites any already set orderBy statements. To stack multiple order statements call <code>addOrderBy($attribute)</code>.</p>
<pre><code class="php">// Order results by last name (ascending).
$users = $lqb-&gt;fromUsers()
    -&gt;where(['firstName' =&gt; 'John'])
    -&gt;orderBy('lastName') 
    -&gt;getResult();
</code></pre>

<hr />
<h4 id="addorderbyattribute-direction-asc">addOrderBy($attribute, $direction = 'ASC')</h4>
<p>This method works the same as <code>orderBy($attribute)</code>, only calling this one will not overwrite already declared order-by 
statements. Call this when you want to order by multiple attributes.</p>
<pre><code class="php">// Order results by last name (descending) and first name (ascending).
$users = $lqb-&gt;fromUsers()
    -&gt;where(['state' =&gt; 'Wisconsin'])
    -&gt;orderBy('lastName', 'DESC')
    -&gt;addOrderBy('firstName', 'ASC')
    -&gt;getResult();
</code></pre>

<hr />
<h4 id="setsizelimitsize">setSizeLimit($size)</h4>
<p>This methods sets the size limit for the amount of results returned from LDAP for the query.</p>
<pre><code class="php">$lqb-&gt;setSizeLimit(10);
</code></pre>

<hr />
<h4 id="setpagesizesize">setPageSize($size)</h4>
<p>This methods sets the paging size for the query. It will default to whatever value you set in your configuration. The
default when no value is explicitly set is 1000.</p>
<pre><code class="php">$lqb-&gt;setPageSize(500);
</code></pre>

<hr />
<h4 id="setusepagingusepaging">setUsePaging($usePaging)</h4>
<p>This methods lets you set whether or not paging should be used for the query. This overrides whatever is set in the
domain configuration. If this is not set, then whatever is set in the domain configuration is used.</p>
<pre><code class="php">$lqb-&gt;setUsePaging(false);
</code></pre>

<hr />
<h4 id="toldapfilter">toLdapFilter()</h4>
<p>Gets the LDAP filter, as a string, that the query would produce.</p>
<pre><code class="php">$filter = $lqb-&gt;toLdapFilter();
</code></pre>

<h2 id="using-aliases">Using Aliases</h2>
<p>When you want to search for multiple object types you can assign them specific aliases to refer to them in your filter.
This makes it easy to get all the results you need with a single query:</p>
<pre><code class="php">use LdapTools\Object\LdapObjectType;

$query = $ldap-&gt;buildLdapQuery();

// Get all users with a department that starts with IT and groups that contain 'admin' in their description.
// The resulting objects are ordered by their name (for both users and groups).
$results = $query
    -&gt;fromUsers('u')
    -&gt;fromGroups('g')
    -&gt;where($query-&gt;filter()-&gt;startsWith('u.department', 'IT'))
    -&gt;andWhere($query-&gt;filter()-&gt;contains('g.description', 'admin'))
    -&gt;sortBy('name')
    -&gt;getLdapQuery()
    -&gt;getResult();

foreach ($results as $result) {
    if ($user-&gt;isType(LdapObjectType::USER)) {
        echo &quot;User: &quot;.$result-&gt;getName();
    } else {
        echo &quot;Group: &quot;.$result-&gt;getName();
    }
}

// Select all OUs and Containers at the root of the domain. Order them by name with OUs first, then containers.
$results = $ldap-&gt;buildLdapQuery()
    -&gt;from(LdapObjectType::OU, 'u')
    -&gt;from(LdapObjectType::CONTAINER, 'c')
    -&gt;addOrderBy('u.name', 'ASC')
    -&gt;addOrderBy('c.name', 'ASC')
    -&gt;setScopeOneLevel()
    -&gt;getLdapQuery()
    -&gt;getResult();
</code></pre>

<p>You can reference an alias in the query builder anywhere that you would reference a specific attribute (select,
orderBy, where/andWhere/or/orWhere statements, etc). The only rule that applies for alias names is that they can only
be alphanumeric (but can also contain underscores).</p>
<h2 id="ldapquery-methods-to-retrieve-ldap-results">LdapQuery Methods to Retrieve LDAP Results</h2>
<hr />
<p>There are a few ways to retrieve LDAP results after you have a query built. How you retrieve the results depends upon
what type of data you're looking for. To start to retrieve results you need to first get a <code>LdapQuery</code> instance by using
the <code>getLdapQuery()</code> method.</p>
<p>The <code>getLdapQuery()</code> method retrieves an instance of the <code>LdapQuery</code> object that you can then call methods on to get 
your results. The <code>LdapQuery</code> object has the filter, page size, base DN, scope, etc that you set in the builder and 
takes care of converting the LDAP results array using a hydration process. It returns an easier to use set of objects. 
Or you can have it return a simple set of arrays with the attributes and values.</p>
<pre><code class="php">
// By default the results will be a collection of LdapUser objects you can iterate over...
$results = $lqb-&gt;getLdapQuery()-&gt;getResult();

foreach ($results as $result) {
    echo $result-&gt;getEmailAddress();
}

// If you just want simple arrays returned you can specify that
$results = $lqb-&gt;getLdapQuery()-&gt;getArrayResult();

foreach ($results as $result) {
    foreach ($result as $attribute =&gt; $value) {
        echo &quot;$attribute =&gt; $value&quot;;
    }
}

</code></pre>

<h4 id="executehydrationtype-hydratorfactoryto_object">execute($hydrationType = HydratorFactory::TO_OBJECT)</h4>
<hr />
<p>This <code>LdapQuery</code> method executes the LDAP filter with the options you have set and returns the results as either a set
objects (this is the default) or as an array (use the hydration type <code>HydratorFactory::TO_ARRAY</code>). See previous example 
for full usage.</p>
<h4 id="getresulthydrationtype-hydratorfactoryto_object">getResult($hydrationType = HydratorFactory::TO_OBJECT)</h4>
<hr />
<p>This is an alias for the <code>execute()</code> method. It will return a <code>LdapObjectCollection</code> by default, or an array of LDAP
entries if specified as <code>getResult(HydratorFactory::TO_ARRAY)</code>.</p>
<h4 id="getarrayresult">getArrayResult()</h4>
<hr />
<p>This functions the same as the <code>getResult()</code> method, but it will always return the LDAP entries as an array instead of a
collection of objects. This is identical to calling <code>getResult(HydratorFactory::TO_ARRAY)</code>.</p>
<h4 id="getsingleresulthydrationtype-hydratorfactoryto_object">getSingleResult($hydrationType = HydratorFactory::TO_OBJECT)</h4>
<hr />
<p>This <code>LdapQuery</code> method will retrieve a single result from LDAP. So instead of a collection of objects or arrays you
will be given a single result you can immediately begin to work with.</p>
<pre><code class="php">$lqb = $ldap-&gt;buildLdapQuery();

// Retrieve a single LdapObject from a query...
$user = $lqb-&gt;fromUsers()
    -&gt;Where(['username' =&gt; 'chad'])
    -&gt;getLdapQuery()
    -&gt;getSingleResult();

echo &quot;DN : &quot;.$user-&gt;getDn();
</code></pre>

<p>If an empty result set is returned from LDAP then it will throw a <code>\LdapTools\Exception\EmptyResultException</code>. If more
than one result is returned from LDAP then it will throw a <code>\LdapTools\Exception\MultiResultException</code>. Additionally, 
you may pass an explicit hydration type to this method if you wish to get the result as a single array of attributes and
values.</p>
<h4 id="getoneornullresulthydrationtype-hydratorfactoryto_object">getOneOrNullResult($hydrationType = HydratorFactory::TO_OBJECT)</h4>
<hr />
<p>The behavior of this method is very similar to <code>getSingleResult()</code>, but if no results are found for the query it will
return <code>null</code> instead of throwing an exception. However, it will still throw an exception in the case that more than one
result is returned from LDAP.</p>
<pre><code class="php">$lqb = $ldap-&gt;buildLdapQuery();

// Retrieve a single LdapObject from a query, or a null result if it doesn't exist...
$user = $lqb-&gt;fromUsers()
    -&gt;Where(['username' =&gt; 'john'])
    -&gt;getLdapQuery()
    -&gt;getOneOrNullResult();

// Could be null, so check first...
if ($user) {
    echo &quot;DN : &quot;.$user-&gt;getDn();
}
</code></pre>

<h4 id="getsinglescalarresult">getSingleScalarResult()</h4>
<hr />
<p>Using this method you can get the value of a single attribute from the query. If the LDAP object or attribute does not
exist then it will throw an exception.</p>
<pre><code class="php">$lqb = $ldap-&gt;buildLdapQuery();

// Retrieve the GUID string of a specific AD user...
$guid = $lqb-&gt;select('guid')
    -&gt;fromUsers()
    -&gt;Where(['username' =&gt; 'chad'])
    -&gt;getLdapQuery()
    -&gt;getSingleScalarResult();

echo &quot;GUID : &quot;.$guid;
</code></pre>

<h4 id="getsinglescalarornullresult">getSingleScalarOrNullResult()</h4>
<hr />
<p>The behavior of this method is very similar to <code>getSingleScalarResult()</code>, but if the attribute is not found/set
for the LDAP object it will return <code>null</code> instead of throwing an exception. However, it will still throw an exception
in the case that more than one result is returned from LDAP or if the LDAP object does not exist.</p>
<pre><code class="php">$lqb = $ldap-&gt;buildLdapQuery();

// Retrieve the title of a specific AD user...
$title = $lqb-&gt;select('title')
    -&gt;fromUsers()
    -&gt;Where(['username' =&gt; 'chad'])
    -&gt;getLdapQuery()
    -&gt;getSingleScalarOrNullResult();

// Check if the attribute actually had a value first
$title = $title ?: 'Unknown';

echo $title;
</code></pre>

<h2 id="filter-method-shortcuts">Filter Method Shortcuts</h2>
<hr />
<p>The <code>filter()</code> method of the <code>LdapQueryBuilder</code> returns a helper class that provides many shortcut methods for creating
the LDAP operator classes within the <code>\LdapTools\Query\Operator</code> namespace. This way you do not have to manually
construct the operators by doing:</p>
<pre><code class="php">use \LdapTools\Query\Operator\bOr;
use \LdapTools\Query\Operator\Comparison;

// ...
$lqb-&gt;where(new bOr(
    new Comparison('firstName', Comparison::EQ, 'Bill'),
    new Comparison('firstName', Comparison::EQ, 'Egon')
));
</code></pre>

<p>Instead you can write:</p>
<pre><code class="php">$lqb-&gt;where($lqb-&gt;filter()-&gt;or(
    $lqb-&gt;filter()-&gt;eq('firstName', 'Bill'),
    $lqb-&gt;filter()-&gt;eq('firstName', 'Egon')
));
</code></pre>

<p>When you call <code>filter()</code> you are just calling a method on the <code>\LdapTools\Query\Builder\FilterBuilder</code> class. The full 
list and description of available methods is below.</p>
<hr />
<h4 id="aeqattribute-value">aeq($attribute, $value)</h4>
<p>Creates an "approximately-equal-to" comparison between the attribute and the value. The results are dependent on the
LDAP specific implementation of this operator. But it will typically function as a "sounds like" comparison: 
<code>(attribute~=value)</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;aeq('firstName', 'Sue');
</code></pre>

<hr />
<h4 id="eqattribute-value">eq($attribute, $value)</h4>
<p>Creates an "equal-to" comparison between the attribute and the value: <code>(attribute=value)</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;eq('lastName', 'Sikorra');
</code></pre>

<hr />
<h4 id="neqattribute-value">neq($attribute, $value)</h4>
<p>Creates a "not-equal-to" comparison between the attribute and the value. This is equivalent to wrapping a
 <code>eq($attribute, $value)</code> within a 'NOT' statement: <code>(!(attribute=value))</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;neq('department', 'Purchasing');
</code></pre>

<hr />
<h4 id="ltattribute-value">lt($attribute, $value)</h4>
<p>Creates a "less-than" comparison between the attribute and the value. Since an actual '&lt;' operator does not exist in 
LDAP, this is a combination of a greater-than-or-equal-to operator along with a check if the attribute is set/present.
This is encapsulated within a logical 'AND' operator: <code>(&amp;(!(attribute&gt;=value))(attribute=*))</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;lt('badPasswordCount', 2);
</code></pre>

<hr />
<h4 id="leqattribute-value">leq($attribute, $value)</h4>
<p>Creates a "less-than-or-equal-to" comparison between the attribute and the value: <code>(attribute&lt;=value)</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;leq('badPasswordCount', 1);
</code></pre>

<hr />
<h4 id="gtattribute-value">gt($attribute, $value)</h4>
<p>Creates a "greater-than" comparison between the attribute and the value. Since an actual '&gt;' operator does not exist in 
LDAP, this is a combination of a less-than-or-equal-to operator along with a check if the attribute is set/present.
This is encapsulated within a logical 'AND' operator: <code>(&amp;(!(attribute&lt;=value))(attribute=*))</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;gt('created', new \DateTime('01-20-2013'));
</code></pre>

<hr />
<h4 id="geqattribute-value">geq($attribute, $value)</h4>
<p>Creates a "greater-than-or-equal-to" comparison between the attribute and the value: <code>(attribute&gt;=value)</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;geq('badPasswordCount', 3);
</code></pre>

<hr />
<h4 id="bitwiseandattribute-value">bitwiseAnd($attribute, $value)</h4>
<p>Creates a bitwise 'AND' comparison between the attribute and the value: <code>(attribute:1.2.840.113556.1.4.803:=value)</code></p>
<pre><code class="php">use LdapTools\Query\UserAccountControlFlags;

$lqb-&gt;filter()-&gt;bitwiseAnd('userAccountControl', UserAccountControlFlags::DISABLED);
</code></pre>

<hr />
<h4 id="bitwiseorattribute-value">bitwiseOr($attribute, $value)</h4>
<p>Creates a bitwise 'OR' comparison between the attribute and the value: <code>(attribute:1.2.840.113556.1.4.804:=value)</code></p>
<pre><code class="php">use LdapTools\Query\GroupTypeFlags;

$lqb-&gt;filter()-&gt;bitwiseOr('groupType', GroupTypeFlags::UNIVERSAL_GROUP);
</code></pre>

<hr />
<h4 id="startswithattribute-value">startsWith($attribute, $value)</h4>
<p>Creates a "equal-to" comparison with a wildcard after the value: <code>(attribute=value*)</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;startsWith('department', 'IT');
</code></pre>

<hr />
<h4 id="endswithattribute-value">endsWith($attribute, $value)</h4>
<p>Creates a "equal-to" comparison with a wildcard before the value: <code>(attribute=*value)</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;endsWith('description', 'service');
</code></pre>

<hr />
<h4 id="containsattribute-value">contains($attribute, $value)</h4>
<p>Creates a "equal-to" comparison with a wildcards at each end of the value: <code>(attribute=*value*)</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;contains('name', 'admin');
</code></pre>

<hr />
<h4 id="likeattribute-value">like($attribute, $value)</h4>
<p>Creates a "equal-to" comparison that will not escape any wildcards you use in the value: <code>(attribute=v*a*l*u*e)</code>.</p>
<pre><code class="php">$lqb-&gt;filter()-&gt;like('description', '*Some*thing*');
</code></pre>

<hr />
<h4 id="presentattribute">present($attribute)</h4>
<p>Creates a "equal-to" comparison with a single wildcard as the value. Returns any entry with this attribute populated: 
<code>(attribute=*)</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;present('mail');
</code></pre>

<hr />
<h4 id="notpresentattribute">notPresent($attribute)</h4>
<p>Creates a negated form of the <code>present($attribute)</code> method. Returns any entry that does not contain the attribute: 
<code>(!(attribute=*))</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;notPresent('department');
</code></pre>

<hr />
<h4 id="bandstatements">bAnd(...$statements)</h4>
<p>Creates a logical 'AND' statement against all other operators passed to it: <code>(&amp;((attribute=value)(attribute=value)))</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;bAnd(
    $lqb-&gt;filter()-&gt;eq('department', 'IT'), 
    $lqb-&gt;filter()-&gt;startsWith('firstName', 'Tim')
);
</code></pre>

<hr />
<h4 id="borstatements">bOr(...$statements)</h4>
<p>Creates a logical 'OR' statement against all other operators passed to it: <code>(|((attribute=value)(attribute=value)))</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;bOr(
    $lqb-&gt;filter()-&gt;eq('department', 'IT'), 
    $lqb-&gt;filter()-&gt;eq('department', 'Purchasing')
);
</code></pre>

<hr />
<h4 id="bnotstatements">bNot($statements)</h4>
<p>Creates a logical 'NOT' statement against whatever other statement you pass it it: <code>(!(attribute=value))</code></p>
<pre><code class="php">$lqb-&gt;filter()-&gt;bNot($lqb-&gt;filter()-&gt;eq('department', 'IT'));
</code></pre>

<h2 id="active-directory-filter-method-shortcuts">Active Directory Filter Method Shortcuts</h2>
<p>If you're using a <code>LdapConnection</code> that has a LDAP type set as <code>ad</code>, then when you call <code>filter()</code> you will also have
additional filter method shortcuts that are specific to Active Directory:</p>
<hr />
<h4 id="hasmemberrecursivelymember-attribute-members">hasMemberRecursively($member, $attribute = 'members')</h4>
<hr />
<p>Recursively checks groups for a specific member. The <code>$member</code> parameter can be any of the following:</p>
<ul>
<li>A username. This must be unique! If a computer and user share the same name then an exception will be thrown.</li>
<li>The GUID of an object (ie. a value like <code>bee66f2f-bcf7-4905-b65b-2f36d5008f1e</code>)</li>
<li>The SID of an object (ie. a value like <code>S-1-5-21-1004336348-1177238915-682003330-512</code>)</li>
<li>The full distinguished name of an object.</li>
<li>A <code>LdapObject</code> as the result of another query.</li>
</ul>
<p>This creates a matching rule comparison using the OID <code>IN_CHAIN</code> against the groups <code>members</code> attribute by default. If
you have a custom attribute, or some other attribute you would like to run it against, you must pass it as the second
argument.</p>
<pre><code class="php">$username = 'chad';

// Query by a username to get all of their groups recursively...
$groups = $ldap-&gt;buildLdapQuery()
    -&gt;fromGroups()
    -&gt;where($query-&gt;filter()-&gt;hasMemberRecursively($username))
    -&gt;getLdapQuery()
    -&gt;getResult();
</code></pre>

<hr />
<h4 id="isrecursivelymemberofgroup">isRecursivelyMemberOf($group)</h4>
<p>Recursively checks an object's group membership for a group. The <code>$group</code> parameter can be any of the following:</p>
<ul>
<li>The name of a group.</li>
<li>The GUID of a group (ie. a value like <code>bee66f2f-bcf7-4905-b65b-2f36d5008f1e</code>)</li>
<li>The SID of a group (ie. a value like <code>S-1-5-21-1004336348-1177238915-682003330-512</code>)</li>
<li>The full distinguished name of a group.</li>
<li>A <code>LdapObject</code> as the result of another query.</li>
</ul>
<p>This creates a matching rule comparison using the OID <code>IN_CHAIN</code> against the users <code>groups</code> attribute.</p>
<pre><code class="php">// Query by a group name...
$query = $ldap-&gt;buildLdapQuery();
$users = $query-&gt;select()
    -&gt;fromUsers()
    -&gt;where($query-&gt;filter()-&gt;isRecursivelyMemberOf('Employees'))
    -&gt;getLdapQuery()
    -&gt;getResult();

// If you are not targeting a specific set of objects from the schema, then you must
// pass 'false' as the second argument and specify a full DN. Otherwise this method
// will attempt to use the 'groups' attribute from the schema by default.
$ldapObjects = $ldap-&gt;buildLdapQuery()
    -&gt;select('description')
    -&gt;where(['cn' =&gt; 'foo'])
    -&gt;andWhere($query-&gt;filter()-&gt;isRecursivelyMemberOf('CN=Foo,DC=foo,DC=bar', false))
    -&gt;getLdapQuery()
    -&gt;getResult();
</code></pre>

<hr />
<h4 id="mailenabled">mailEnabled()</h4>
<hr />
<p>Performs a simple check to determine whether an LDAP object is mail-enabled (ie. can receive email from Exchange).</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright &copy; 2015, Chad Sikorra.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
