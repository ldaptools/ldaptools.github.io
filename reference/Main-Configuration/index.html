<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Chad Sikorra">
        <link rel="canonical" href="http://www.phpldaptools.com/reference/Main-Configuration/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Main Configuration - LdapTools</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">LdapTools</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cookbook <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../cookbook/Authenticating-a-User/">Authenticating a User</a>
</li>
                            
<li >
    <a href="../../cookbook/Common-LDAP-Queries/">Common LDAP Queries</a>
</li>
                            
<li >
    <a href="../../cookbook/Creating-Exchange-Mailboxes/">Creating Exchange Mailboxes</a>
</li>
                            
<li >
    <a href="../../cookbook/Creating-a-Custom-Repository/">Creating a Custom Repository</a>
</li>
                            
<li >
    <a href="../../cookbook/Getting-Your-LDAP-SSL-Certificate/">Getting Your LDAP SSL Certificate</a>
</li>
                            
<li >
    <a href="../../cookbook/Modifying-GPO-Links-on-OUs/">Modifying GPO Links on OUs</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../Attribute-Converters/">Attribute Converters</a>
</li>
                            
<li >
    <a href="../Default-Schema-Attributes/">Default Schema Attributes</a>
</li>
                            
<li >
    <a href="../Events/">Events</a>
</li>
                            
<li >
    <a href="../Logging/">Logging</a>
</li>
                            
<li class="active">
    <a href="./">Main Configuration</a>
</li>
                            
<li >
    <a href="../Schema-Configuration/">Schema Configuration</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../tutorials/AD-Permissions/">AD Permissions</a>
</li>
                            
<li >
    <a href="../../tutorials/AD-User-Modification/">AD User Modification</a>
</li>
                            
<li >
    <a href="../../tutorials/Building-LDAP-Queries/">Building LDAP Queries</a>
</li>
                            
<li >
    <a href="../../tutorials/Creating-AD-Password-Settings-Objects/">Creating AD Password Settings Objects</a>
</li>
                            
<li >
    <a href="../../tutorials/Creating-LDAP-Objects/">Creating LDAP Objects</a>
</li>
                            
<li >
    <a href="../../tutorials/LDIF-Files/">LDIF Files</a>
</li>
                            
<li >
    <a href="../../tutorials/Modifying-LDAP-Objects/">Modifying LDAP Objects</a>
</li>
                            
<li >
    <a href="../../tutorials/Using-the-LDAP-Manager/">Using the LDAP Manager</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../Logging/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Schema-Configuration/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/ldaptools/ldaptools/">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#main-configuration">Main Configuration</a></li>
            <li><a href="#manual-configuration">Manual Configuration</a></li>
            <li><a href="#yaml-configuration">YAML Configuration</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="main-configuration">Main Configuration</h1>
<hr />
<ul>
<li><a href="#manual-configuration">Manual Configuration</a></li>
<li><a href="#yaml-configuration">YAML Configuration</a></li>
<li><a href="#general-section">Main Configuration Options</a></li>
<li><a href="#domain-section">Domain Configuration Options</a></li>
</ul>
<p>You can either choose to configure your settings via a file (YAML) or directly using the methods on the <code>Configuration</code> 
and <code>DomainConfiguration</code> classes. Once you have an instance of the configuration, you can pass it to the <code>LdapManager</code>
class.</p>
<h2 id="manual-configuration">Manual Configuration</h2>
<hr />
<pre><code class="php">use LdapTools\Configuration;
use LdapTools\DomainConfiguration;
use LdapTools\LdapManager;

// A new configuration object contains the most common default settings.
$config = new Configuration();

// A domain configuration object. Requires a domain name, servers, username, and password. 
$domain = (new DomainConfiguration('mydomain.com'))
   -&gt;setBaseDn('dc=mydomain,dc=com')
   -&gt;setServers(['dc01'])
   -&gt;setUsername('username')
   -&gt;setPassword('password');
$altDomain = (new DomainConfiguration('foo.bar'))
   -&gt;setBaseDn('dc=foo,dc=bar')
   -&gt;setServers(['foo'])
   -&gt;setUsername('username')
   -&gt;setPassword('password')
   -&gt;setLazyBind(true)
   -&gt;setLdapType('openldap');
$config-&gt;addDomain($domain, $altDomain);
// Defaults to the first domain added. You can change this if you want.
$config-&gt;setDefaultDomain('foo.bar');

// The LdapManager provides an easy point of access to some different classes.
$ldap = new LdapManager($config);
</code></pre>

<h2 id="yaml-configuration">YAML Configuration</h2>
<hr />
<p>The easy way to configure everything is by using a single YAML configuration file. See the <a href="https://github.com/ldaptools/ldaptools/blob/master/resources/config/example.yml">example configuration</a>
for a detailed overview. The YAML file is split into a <code>general</code> section and a <code>domains</code> section. </p>
<pre><code class="yaml">general:
...
domains:
    domain_one:
    ...
    domain_two:
    ...
</code></pre>

<p>Once you have a YAML configuration file defined, you can configure the class very easily:</p>
<pre><code class="php">use LdapTools\Configuration;
use LdapTools\LdapManager;

$config = (new Configuration())-&gt;load('/path/to/ldap/config.yml');
$ldap = new LdapManager($config);
</code></pre>

<p>The below reference describes each possible configuration directive.</p>
<h3 id="general-section"><strong>General Section</strong></h3>
<hr />
<h4 id="default_domain">default_domain</h4>
<p>If you have added more than one domain configuration, set this to the domain name (ie. <code>example.com</code>) you would like to 
be the default context when using the <code>LdapManager</code> class.</p>
<p><strong>Default</strong>: If more than one domain is present, the first domain added is the default domain.</p>
<hr />
<h4 id="schema_format">schema_format</h4>
<p>The format that the schema file is in. Only <code>yml</code> is available at present.</p>
<p><strong>Default</strong>: <code>yml</code></p>
<hr />
<h4 id="schema_folder">schema_folder</h4>
<p>This is where the LDAP object schema definition files are stored.</p>
<p><strong>Default</strong>: The <code>resources/schema</code> folder in the libraries root directory.</p>
<hr />
<h4 id="cache_type">cache_type</h4>
<p>The default caching mechanism to use when parsing schema files. Options are <code>stash</code>, <code>doctrine</code>, or <code>none</code>. When <code>stash</code>
 or <code>doctrine</code> is used it will take the parsed LDAP schema objects and cache them to disk. It will then use the cache 
instead of re-parsing the schema each time. </p>
<p>The <code>stash</code> type will auto-refresh the cache if it detects that the schema file has been modified since it was last
cached. it will re-parse it and cache it again. This behavior can be changed by using the <code>cache_options</code>
described below and setting <code>cache_auto_refresh: false</code>.</p>
<p>To manually clear the cache so it rebuilds you can call the <code>clear()</code> method on the cache from the <code>LdapManager</code> class.</p>
<pre><code class="php">// Clears all contents of the cache.
$ldapManager-&gt;getCache()-&gt;clear();
</code></pre>

<p>To use the <code>stash</code> type you must install <a href="https://github.com/tedious/Stash">Stash</a>.
To use the <code>doctrine</code> type you must install <a href="https://github.com/doctrine/cache">Doctrine Cache</a>.</p>
<p><strong>Default:</strong> <code>none</code></p>
<hr />
<h4 id="cache_options">cache_options</h4>
<p>An array of options that will be passed to the cache type when it is instantiated.</p>
<p>For the <code>doctrine</code> and <code>stash</code> types you can pass a few options that control how they work:</p>
<pre><code class="yml">cache_options:
    # Make it so the cache must be manually cleared for it to update. Stash auto-refreshes by default.
    # The doctrine type does not support auto-refresh so this option will not affect it.
    cache_auto_refresh: false
    # The full path to the location where the cache contents should be kept. If not set it defaults to the systems temp
    # directory.
    cache_folder: /tmp/www
    # The subdirectory/location name in the cache directory to store the cache. Defaults to 'ldaptools'. 
    cache_prefix: ldaptools
</code></pre>

<p><strong>Defaults</strong>: No options are passed by default.</p>
<hr />
<h4 id="attribute_converters">attribute_converters</h4>
<p>An array of converter to class name mappings that will be registered in the <code>LdapManager</code> for use in the schemas.</p>
<pre><code class="yaml">general:
    attribute_converters:
        # This class must extend \LdapTools\AttributeConverter\AttributeConverterInterface !
        my_converter: '\My\Converter\Class'
</code></pre>

<p><strong>Defaults</strong>: No additional attribute converters are registered by default.</p>
<hr />
<h3 id="domain-section"><strong>Domain Section</strong></h3>
<hr />
<h4 id="domain_name-required">domain_name <strong>(REQUIRED)</strong></h4>
<p>The FQDN of the domain (ie. <code>example.com</code>).</p>
<hr />
<h4 id="username-required">username <strong>(REQUIRED)</strong></h4>
<p>The username to use when binding to LDAP. When using Active Directory, the username can be in any of these formats:</p>
<ul>
<li>A typical username in UPN form (ie. <code>user@domain.com</code>).</li>
<li>A string GUID of an account (ie. <code>8227ab9b-b307-45eb-a50c-6f6cb3946318</code>)</li>
<li>A string SID of an account (ie. <code>S-1-5-21-1004336348-1177238915-682003330-512</code>)</li>
<li>The full distinguished name of an account.</li>
</ul>
<p>If none of those forms are detected, then by default it will force the username into UPN form based off of the domain
name. However, if the LDAP type is <code>openldap</code>, then it will just pass the unmodified username along. This behavior can 
be modified using the <code>bind_format</code> option.</p>
<hr />
<h4 id="password-required">password <strong>(REQUIRED)</strong></h4>
<p>The password to use when binding to LDAP.</p>
<hr />
<h4 id="base_dn">base_dn</h4>
<p>The base DN for searches (ie. The default naming context: <code>dc=example,dc=com</code>). If this is empty then the RootDSE will
be queried for the <code>defaultNamingContext</code> value. It is recommended that you define this manually for better performance.</p>
<hr />
<h4 id="servers">servers</h4>
<p>An array of LDAP servers (ie. <code>[ 'dc01' ]</code>). When more than one server name is used it will attempt each one until it
successfully connects. If no servers are given then it will attempt to lookup the LDAP servers for the domain by
querying DNS. It is recommended that you define this manually for faster and more predictable results.</p>
<hr />
<h4 id="bind_format">bind_format</h4>
<p>Defines how the username will be passed to LDAP on a bind/authentication attempt. This is a string that accepts 2
parameters: <code>%username%</code> and <code>%domainname%</code>. By default, the AD bind format is <code>%username%@%domainname%</code>. With OpenLDAP
it is simply <code>%username%</code>. However, you could set it to an DN path, such as: <code>CN=%username%,OU=Users,DC=example,DC=com</code></p>
<hr />
<h4 id="server_selection">server_selection</h4>
<p>When more than one server is listed for a domain, choose which one is selected for the connection. The possible choices 
are <code>order</code> (tried in the order they appear) or <code>random</code>. </p>
<p><strong>Default</strong>: <code>order</code></p>
<hr />
<h4 id="use_paging">use_paging</h4>
<p>Whether or not the connection should try to page results by default.</p>
<p><strong>Default</strong>: <code>true</code></p>
<hr />
<h4 id="page_size">page_size</h4>
<p>The default page size to use for paging operations.</p>
<p><strong>Default</strong>: <code>1000</code></p>
<hr />
<h4 id="port">port</h4>
<p>The default port number to connect to LDAP on.</p>
<p><strong>Default</strong>: <code>389</code></p>
<hr />
<h4 id="use_ssl">use_ssl</h4>
<p>Whether or not to talk to LDAP over SSL. The default is <code>false</code>. Typically you want to use the <code>use_tls</code> directive (in
the case of Active Directory). Setting this to <code>true</code> also changes the port to <code>636</code>.</p>
<p><strong>Default</strong>: <code>false</code></p>
<hr />
<h4 id="use_tls">use_tls</h4>
<p>Whether or not to initiate TLS when connecting to LDAP. This is required for certain LDAP operations (such as password 
changes in Active Directory). When using this directive you will often have to configure your <code>ldap.conf</code> file and add
the <code>TLS_REQCERT never</code> line. The <code>ldap.conf</code> file is in the following default locations:</p>
<ul>
<li>Windows: <code>C:\OpenLDAP\sysconf\ldap.conf</code> (If this directory structure does not exist, then create it...and the file)</li>
<li>Linux: <code>/etc/ldap/ldap.conf</code></li>
</ul>
<p>However, be warned that using <code>TLS_REQCERT never</code> can be a bit of a security risk as it ignores invalid certificates.
Consider copying your domain CA cert to <code>/etc/ssl/certs</code> then reference it in your <code>ldap.conf</code> with the <code>TLS_CACERT /etc/ssl/certs/ca.pem</code>
option combined with <code>TLS_REQCERT hard</code>.</p>
<p>For more information on obtaining/using your LDAP SSL certificates, see <a href="../../cookbook/Getting-Your-LDAP-SSL-Certificate/">this cookbook doc</a>.</p>
<p><strong>Default</strong>: <code>false</code></p>
<hr />
<h4 id="ldap_type">ldap_type</h4>
<p>The LDAP type for this domain. Choices are <code>ad</code> or <code>openldap</code>.</p>
<p><strong>Default</strong>: <code>ad</code></p>
<hr />
<h4 id="lazy_bind">lazy_bind</h4>
<p>If set to <code>true</code>, then the connection will not automatically connect and bind when first created.</p>
<p><strong>Default</strong>: <code>false</code></p>
<hr />
<h4 id="schema_name">schema_name</h4>
<p>The schema name to use for this domain. This typically refers to the name of the schema file to use within the path 
defined by the <code>schema_folder</code> directive in the general section. </p>
<p><strong>Default</strong>: The same value set for <code>ldap_type</code>.</p>
<hr />
<h4 id="encoding">encoding</h4>
<p>The encoding to use for this domain. Usernames, passwords, and any values not explicitly assigned to an Attribute
Converter will be encoded with this encoding choice.</p>
<p><strong>Default</strong>: UTF-8</p>
<hr />
<h4 id="ldap_options">ldap_options</h4>
<p>The <code>LDAP_OPT_*</code> constants and values to use when connecting to LDAP. This is expected to be an array:</p>
<pre><code class="yaml">domains:
    example:
        ldap_options:
            ldap_opt_protocol_version: 3
            ldap_opt_referrals: 0
</code></pre>

<p><strong>Default</strong>: <code>[LDAP_OPT_PROTOCOL_VERSION =&gt; 3, LDAP_OPT_REFERRALS =&gt; 0]</code></p>
<hr />
<h4 id="idle_reconnect">idle_reconnect</h4>
<p>The elapsed time (in seconds) when an idle connection will attempt to reconnect to LDAP. A value of 0 means never. This
is useful for long running processes where an LDAP connection is left open.</p>
<p>You should set this value sightly below the max idle time for your LDAP server. For Active Directory, idle connections 
timeout after 15 minutes by default. For OpenLDAP, idle connections never timeout by default. You should check your
LDAP server settings before changing this value.</p>
<pre><code class="yaml">domains:
    example:
        idle_reconnect: 0
</code></pre>

<p><strong>Default</strong>: <code>600</code> (10 minutes)</p>
<hr />
<h4 id="connect_timeout">connect_timeout</h4>
<p>The elapsed time (in seconds) to attempt the initial connection to the LDAP server. If a connection cannot be established
within this time the server will be considered unreachable/down.</p>
<pre><code class="yaml">domains:
    example:
        connect_timeout: 5
</code></pre>

<p><strong>Default</strong>: <code>1</code></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2015, Chad Sikorra.</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
