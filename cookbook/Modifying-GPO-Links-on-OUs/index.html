<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Chad Sikorra">
        <link rel="canonical" href="http://www.phpldaptools.com/cookbook/Modifying-GPO-Links-on-OUs/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>Modifying GPO Links on OUs - LdapTools</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">LdapTools</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../reference/Attribute-Converters">Attribute Converters</a>
                            </li>
                        
                            <li >
                                <a href="../../reference/Default-Schema-Attributes">Default Schema Attributes</a>
                            </li>
                        
                            <li >
                                <a href="../../reference/Main-Configuration">Main Configuration</a>
                            </li>
                        
                            <li >
                                <a href="../../reference/Schema-Configuration">Schema Configuration</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cookbook <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../Authenticating-a-User">Authenticating a User</a>
                            </li>
                        
                            <li >
                                <a href="../Creating-a-Custom-Repository">Creating a Custom Repository</a>
                            </li>
                        
                            <li class="active">
                                <a href=".">Modifying GPO Links on OUs</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../tutorials/AD-User-Modification">AD User Modification</a>
                            </li>
                        
                            <li >
                                <a href="../../tutorials/Building-LDAP-Queries">Building LDAP Queries</a>
                            </li>
                        
                            <li >
                                <a href="../../tutorials/Creating-LDAP-Objects">Creating LDAP Objects</a>
                            </li>
                        
                            <li >
                                <a href="../../tutorials/Modifying-LDAP-Objects">Modifying LDAP Objects</a>
                            </li>
                        
                            <li >
                                <a href="../../tutorials/Using-the-LDAP-Manager">Using the LDAP Manager</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../Creating-a-Custom-Repository">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../../tutorials/AD-User-Modification">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/ldaptools/ldaptools/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#modifying-gpo-links-on-ous">Modifying GPO Links on OUs</a></li>
        
            <li><a href="#creating-an-ou-with-a-linked-gpo">Creating an OU With a Linked GPO</a></li>
        
            <li><a href="#modifying-gpos-on-an-existing-ou">Modifying GPOs on an Existing OU</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="modifying-gpo-links-on-ous">Modifying GPO Links on OUs</h1>
<hr />
<p>When working with Active Directory OUs you may want to add, remove, or display GPOs that are linked to a specific OU.
This can be accomplished through the use of the <code>gpoLinks</code> attribute for the OU type. This attribute can be leveraged on
OU creation or modification to easily set what GPOs should be linked at that OU level. The attribute value functions as
an array of GPO names that are linked to the OU.</p>
<h2 id="creating-an-ou-with-a-linked-gpo">Creating an OU With a Linked GPO</h2>
<p>For example, assume you would like to create an OU named "Employees" that should have 2 GPOs linked to it named 
"Employee Policy" and "Require Screensaver":</p>
<pre><code class="php">
$ldapObject = $ldapManager-&gt;createLdapObject();

try {
    $object-&gt;createOU()
        -&gt;in('dc=example,dc=local')
        -&gt;with(['name' =&gt; 'Employees', 'gpoLinks' =&gt; ['Employee Policy', 'Require Screensaver']])
        -&gt;execute();
} catch (LdapConnectionException $e) {
    echo &quot;Failed to create OU - &quot;.$e-&gt;getMessage();
}
</code></pre>

<h2 id="modifying-gpos-on-an-existing-ou">Modifying GPOs on an Existing OU</h2>
<p>Assume you have an existing OU and would like to remove or add a GPO link from it:</p>
<pre><code class="php">use LdapTools\Object\LdapObjectType;

//...

$repository = $ldapManager-&gt;getRepository(LdapObjectType::OU);

// gpoLinks are not retrieved by default, so make sure to select them.
$repository-&gt;setAttributes(['name', 'gpoLinks']);
$ou = $repository-&gt;findOneByName('My Special OU');

// Check for, and then remove, the name of an existing GPO if it is linked...
if ($ou-&gt;hasGpoLinks('Require Screensaver')) {
    $ou-&gt;removeGpoLinks('Require Screensaver');
}

// Add a new GPO link to the OU...
$ou-&gt;addGpoLinks('Restricted Access');

// Now actually save the changes back to LDAP
try {
    $ldapManager-&gt;persist($ou);
} catch (\Exception $e) {
    echo &quot;Failed to modify OU - &quot;.$e-&gt;getMessage();
}
</code></pre>

</div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Copyright &copy; 2015, Chad Sikorra.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>